generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum Role {
    ADMIN
    USER
    DOCTOR
}

enum AppointmentStatus {
    CREATED
    ASSIGNED
    CONFIRMED
    COMPLETED
    CANCELLED
}

enum CaseStatus {
    OPEN
    IN_PROGRESS
    RESOLVED
    CLOSED
}

model User {
    id        String  @id @default(uuid())
    name      String
    email     String  @unique
    password  String
    role      Role
    isDeleted Boolean @default(false)

    createdAppointments  Appointment[] @relation("CreatedAppointments")
    assignedAppointments Appointment[] @relation("AssignedAppointments")
    cases                Case[]
    // cases Case[] @relation("UserCases")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Appointment {
    id              String            @id @default(uuid())
    appointmentDate DateTime
    status          AppointmentStatus @default(CREATED)

    createdByUserId  String
    assignedDoctorId String?

    createdByUser  User  @relation("CreatedAppointments", fields: [createdByUserId], references: [id])
    assignedDoctor User? @relation("AssignedAppointments", fields: [assignedDoctorId], references: [id])

    case Case?

    isDeleted Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([createdByUserId])
    @@index([assignedDoctorId])
    @@index([appointmentDate])
    @@index([status])
}

model Case {
    id String @id @default(uuid())

    appointmentId String      @unique
    appointment   Appointment @relation(fields: [appointmentId], references: [id])

    doctorId String
    doctor   User   @relation(fields: [doctorId], references: [id])
    //doctor  User @relation("DoctorCases", fields: [doctorId], references: [id])

    userId String
    user   User   @relation(fields: [userId], references: [id])
    // user User @relation("UserCases", fields: [userId], references: [id])

    status      CaseStatus @default(OPEN)
    description String?

    isDeleted Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
